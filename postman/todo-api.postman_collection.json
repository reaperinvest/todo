{
  "info": {
    "name": "Todo API (Local)",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "description": "Collection to test the local Todo API backed by PostgreSQL. Set {{baseUrl}} to your server, e.g. http://localhost:4000"
  },
  "item": [
    {
      "name": "Health",
      "request": {
        "method": "GET",
        "url": { "raw": "{{baseUrl}}/api/health", "host": ["{{baseUrl}}"], "path": ["api", "health"] }
      },
      "event": [
        {"listen":"test","script":{"exec":[
          "pm.test('status 200', () => pm.response.code === 200);",
          "pm.test('ok true', () => pm.response.json().ok === true);"
        ],"type":"text/javascript"}}
      ]
    },
    {
      "name": "List todos",
      "request": {
        "method": "GET",
        "url": { "raw": "{{baseUrl}}/api/todos", "host": ["{{baseUrl}}"], "path": ["api", "todos"] }
      }
    },
    {
      "name": "Create todo",
      "request": {
        "method": "POST",
        "header": [ {"key":"Content-Type","value":"application/json"} ],
        "body": {"mode":"raw","raw":"{\n  \"text\": \"Write docs\",\n  \"priority\": \"medium\"\n}"},
        "url": { "raw": "{{baseUrl}}/api/todos", "host": ["{{baseUrl}}"], "path": ["api", "todos"] }
      },
      "event": [
        {"listen":"test","script":{"exec":[
          "pm.test('created 201', () => pm.response.code === 201);",
          "const j = pm.response.json(); pm.environment.set('todoId', j.id);"
        ],"type":"text/javascript"}}
      ]
    },
    {
      "name": "Update todo (completed=true)",
      "request": {
        "method": "PATCH",
        "header": [ {"key":"Content-Type","value":"application/json"} ],
        "body": {"mode":"raw","raw":"{\n  \"completed\": true\n}"},
        "url": { "raw": "{{baseUrl}}/api/todos/{{todoId}}", "host": ["{{baseUrl}}"], "path": ["api", "todos", "{{todoId}}"] }
      }
    },
    {
      "name": "Delete todo",
      "request": {
        "method": "DELETE",
        "url": { "raw": "{{baseUrl}}/api/todos/{{todoId}}", "host": ["{{baseUrl}}"], "path": ["api", "todos", "{{todoId}}"] }
      }
    },
    {
      "name": "Clear completed",
      "request": {
        "method": "DELETE",
        "url": { "raw": "{{baseUrl}}/api/todos?only=completed", "host": ["{{baseUrl}}"], "path": ["api", "todos"], "query":[{"key":"only","value":"completed"}] }
      }
    },
    {
      "name": "Clear all",
      "request": {
        "method": "DELETE",
        "url": { "raw": "{{baseUrl}}/api/todos", "host": ["{{baseUrl}}"], "path": ["api", "todos"] }
      }
    }
  ],
  "variable": [
    { "key": "baseUrl", "value": "http://localhost:4000" }
  ]
}


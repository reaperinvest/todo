{
  "info": {
    "_postman_id": "6d5f9f2b-3c76-4a8e-9a32-83b3b1b9a111",
    "name": "Todo API (Local)",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "description": "Test the local Todo API backed by PostgreSQL. Set {{baseUrl}} to your server (default http://localhost:4000)."
  },
  "item": [
    {
      "name": "Health",
      "request": { "method": "GET", "url": "{{baseUrl}}/api/health" },
      "event": [{
        "listen": "test",
        "script": {"type":"text/javascript","exec":[
          "pm.test('status 200', function () { pm.response.to.have.status(200); });",
          "pm.test('ok true', function () { pm.expect(pm.response.json().ok).to.eql(true); });"
        ]}
      }]
    },
    {
      "name": "List todos",
      "request": { "method": "GET", "url": "{{baseUrl}}/api/todos" },
      "event": [{
        "listen": "test",
        "script": {"type":"text/javascript","exec":[
          "pm.test('status 200', function () { pm.response.to.have.status(200); });",
          "pm.test('is array', function () { pm.expect(pm.response.json()).to.be.an('array'); });"
        ]}
      }]
    },
    {
      "name": "Create todo",
      "request": {
        "method": "POST",
        "header": [{"key":"Content-Type","value":"application/json"}],
        "body": {"mode":"raw","raw":"{\n  \"text\": \"Write docs\",\n  \"priority\": \"medium\"\n}"},
        "url": "{{baseUrl}}/api/todos"
      },
      "event": [{
        "listen": "test",
        "script": {"type":"text/javascript","exec":[
          "pm.test('created 201', function () { pm.response.to.have.status(201); });",
          "const j = pm.response.json();",
          "pm.test('has id', function () { pm.expect(j).to.have.property('id'); });",
          "pm.test('text string', function () { pm.expect(j.text).to.be.a('string'); });",
          "pm.test('priority valid', function () { pm.expect(['low','medium','high']).to.include(j.priority); });",
          "pm.environment.set('todoId', j.id);"
        ]}
      }]
    },
    {
      "name": "Update todo (completed=true)",
      "request": {
        "method": "PATCH",
        "header": [{"key":"Content-Type","value":"application/json"}],
        "body": {"mode":"raw","raw":"{\n  \"completed\": true\n}"},
        "url": "{{baseUrl}}/api/todos/{{todoId}}"
      },
      "event": [{
        "listen": "test",
        "script": {"type":"text/javascript","exec":[
          "pm.test('status 200', function () { pm.response.to.have.status(200); });",
          "const j = pm.response.json();",
          "pm.test('id matches', function () { pm.expect(j.id).to.eql(pm.environment.get('todoId')); });",
          "pm.test('completed true', function () { pm.expect(j.completed).to.eql(true); });",
          "pm.test('timestamps present', function () { pm.expect(j.createdAt).to.be.a('number'); pm.expect(j.updatedAt).to.be.a('number'); });"
        ]}
      }]
    },
    {
      "name": "Delete todo",
      "request": { "method": "DELETE", "url": "{{baseUrl}}/api/todos/{{todoId}}" },
      "event": [{
        "listen": "test",
        "script": {"type":"text/javascript","exec":[
          "pm.test('status 204', function () { pm.response.to.have.status(204); });"
        ]}
      }]
    },
    {
      "name": "Clear completed",
      "request": { "method": "DELETE", "url": "{{baseUrl}}/api/todos?only=completed" },
      "event": [{
        "listen": "test",
        "script": {"type":"text/javascript","exec":[
          "pm.test('status 204', function () { pm.response.to.have.status(204); });"
        ]}
      }]
    },
    {
      "name": "Clear all",
      "request": { "method": "DELETE", "url": "{{baseUrl}}/api/todos" },
      "event": [{
        "listen": "test",
        "script": {"type":"text/javascript","exec":[
          "pm.test('status 204', function () { pm.response.to.have.status(204); });"
        ]}
      }]
    }
  ],
  "variable": [{ "key": "baseUrl", "value": "http://localhost:4000" }]
}
